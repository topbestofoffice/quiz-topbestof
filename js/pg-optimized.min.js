(function(){"use strict";if(/bot|googlebot|crawler|spider|robot|crawling|facebookexternalhit|lighthouse/i.test(navigator.userAgent)){console.warn("Bot detected - disabling ad script");return}window.pg=window.pg||{};const pg=window.pg;const config=window.TopbestofAdConfig||{};pg.timestamps=pg.timestamps||{};pg.timestamps.started=Date.now();pg.timestamps.now=()=>Date.now();pg.config={networkCode:config.networkCode||"22760191030",timeout:config.timeout||2e3,refreshMax:config.refreshMax||0,refreshTimeout:50,lazy:config.lazy!==undefined?config.lazy:true,lazyDepth:config.lazyDepth||1.75,anchor:config.anchor!==undefined?config.anchor:true,rewarded:config.rewarded!==undefined?config.rewarded:true,vignette:config.vignette!==undefined?config.vignette:true,vignetteChance:config.vignetteChance||.3,vignetteDelay:config.vignetteDelay||1e4,offerwall:config.offerwall||false,rebid:config.rebid!==undefined?config.rebid:true,rebidRounds:config.rebidRounds||2,rebidPercent:1,rebidMultiplier:config.rebidMultiplier||.7,botThreshold:75,clickBlocker:config.botProtection!==undefined?config.botProtection:true,clickBlockerThreshold:config.clickThreshold||30,rewardCoins:config.rewardCoins||100,debug:config.debug||false};pg.adUnits=config.adUnits||[{code:"/22760191030/j4512323",slot:"Topbestof_Mobile_Leaderboard",device:"mobile",sizes:[[300,250],[250,250],[336,280],[320,480]],type:"display"},{code:"/22760191030/j4578325",slot:"Topbestof_Mobile_Top",device:"mobile",sizes:[[250,250],[300,250],[336,280],[336,336]],type:"display"},{code:"/22760191030/Topbestof_Mobile_Anchor",slot:"Topbestof_Mobile_Anchor",device:"mobile",sizes:[[320,50],[320,100],[300,50],[300,100]],type:"display",anchor:true}];pg.utils={uuid4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){const r=Math.random()*16|0;const v=c=="x"?r:r&3|8;return v.toString(16)})},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768},log:function(message,category){if(pg.debugging()){console.log(`[PG-${category||"main"}] ${message}`)}},cookie:function(name,value,days){if(value!==undefined){let expires="";if(days){const date=new Date;date.setTime(date.getTime()+days*24*60*60*1e3);expires="; expires="+date.toUTCString()}document.cookie=name+"="+value+expires+"; path=/";return value}const nameEQ=name+"=";const ca=document.cookie.split(";");for(let i=0;i<ca.length;i++){let c=ca[i];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length)}return null}};pg.debugging=function(){return pg.config.debug||window.location.search.includes("pg_debug")||window.location.hostname==="localhost"||window.localStorage&&window.localStorage.getItem("pg_debug")};pg.botProtection={clickCount:0,suspiciousActivity:false,init:function(){document.addEventListener("click",this.trackClicks.bind(this));this.detectBotBehavior()},trackClicks:function(){this.clickCount++;if(this.clickCount>pg.config.clickBlockerThreshold*10){this.suspiciousActivity=true;pg.utils.log("Suspicious clicking detected","security")}},detectBotBehavior:function(){const startTime=Date.now();let interactions=0;["click","scroll","keypress","mousemove"].forEach(event=>{document.addEventListener(event,()=>interactions++,{once:true})});setTimeout(()=>{if(interactions===0&&Date.now()-startTime>5e3){pg.utils.log("Potential bot behavior detected","security");this.suspiciousActivity=true}},5e3)}};pg.gam={initialized:false,slots:{},init:function(){if(this.initialized)return;window.googletag=window.googletag||{};window.googletag.cmd=window.googletag.cmd||[];googletag.cmd.push(()=>{googletag.pubads().enableSingleRequest();googletag.pubads().collapseEmptyDivs();googletag.pubads().setCentering(true);googletag.enableServices();pg.utils.log("Google Ad Manager initialized","gam")});this.initialized=true},createSlot:function(adUnit){const slotId="pg-"+adUnit.slot.toLowerCase().replace(/_/g,"-");googletag.cmd.push(()=>{const slot=googletag.defineSlot(adUnit.code,adUnit.sizes,slotId).addService(googletag.pubads());this.slots[slotId]=slot;pg.utils.log(`Created slot: ${slotId}`,"gam")});return slotId}};pg.rewarded={available:false,callbacks:{filled:[],unfilled:[],granted:[],abandoned:[]},init:function(){pg.reif=pg.reif||[];pg.reiuf=pg.reiuf||[];pg.regq=pg.regq||[];pg.reaq=pg.reaq||[];pg.reif.push(this.onFilled.bind(this));pg.reiuf.push(this.onUnfilled.bind(this));pg.regq.push(this.onGranted.bind(this));pg.reaq.push(this.onAbandoned.bind(this));this.loadPubGuruRewarded()},loadPubGuruRewarded:function(){this.simulateRewardedAds()},simulateRewardedAds:function(){setTimeout(()=>{const mockRenderEvent={makeRewardedVisible:()=>{this.showRewardedAd()}};this.onFilled(mockRenderEvent)},2e3)},showRewardedAd:function(){const overlay=document.createElement("div");overlay.style.cssText=`
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.9); z-index: 10000;
                display: flex; justify-content: center; align-items: center;
                color: white; font-family: Arial, sans-serif;
            `;overlay.innerHTML=`
                <div style="text-align: center; padding: 20px; background: #333; border-radius: 10px;">
                    <h2>ðŸŽ¥ Rewarded Video Ad</h2>
                    <p>Watch this ad to earn 100 coins!</p>
                    <div style="margin: 20px 0;">
                        <div style="width: 300px; height: 200px; background: #555; display: flex; align-items: center; justify-content: center;">
                            <p>ðŸ“º Video Ad Playing...</p>
                        </div>
                    </div>
                    <button id="rewardedAdComplete" style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                        Claim Reward
                    </button>
                    <button id="rewardedAdClose" style="background: #f44336; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                        Skip
                    </button>
                </div>
            `;document.body.appendChild(overlay);document.getElementById("rewardedAdComplete").onclick=()=>{document.body.removeChild(overlay);this.onGranted({})};document.getElementById("rewardedAdClose").onclick=()=>{document.body.removeChild(overlay);this.onAbandoned({})}},onFilled:function(renderEvent){this.available=true;window.pgRenderEvent=renderEvent;pg.utils.log("Rewarded ad filled and ready","rewarded");this.callbacks.filled.forEach(cb=>cb(renderEvent))},onUnfilled:function(){this.available=false;pg.utils.log("Rewarded ad unfilled","rewarded");this.callbacks.unfilled.forEach(cb=>cb())},onGranted:function(renderEvent){pg.utils.log("Reward granted","rewarded");const coinReward=pg.config.rewardCoins;if(window.TopbestofAdConfig&&window.TopbestofAdConfig.callbacks.onRewardGranted){window.TopbestofAdConfig.callbacks.onRewardGranted(coinReward)}this.callbacks.granted.forEach(cb=>cb(renderEvent,coinReward))},onAbandoned:function(event){pg.utils.log("Reward abandoned","rewarded");this.callbacks.abandoned.forEach(cb=>cb(event))},show:function(){if(!this.available||!window.pgRenderEvent){pg.utils.log("No rewarded ad available","rewarded");return false}try{if(typeof window.pgRenderEvent.makeRewardedVisible==="function"){window.pgRenderEvent.makeRewardedVisible();return true}}catch(error){pg.utils.log("Error showing rewarded ad: "+error.message,"rewarded")}return false}};pg.lazy={observer:null,init:function(){if(!("IntersectionObserver"in window)){pg.utils.log("IntersectionObserver not supported, loading all ads","lazy");this.loadAllAds();return}const options={rootMargin:`${window.innerHeight*pg.config.lazyDepth}px`};this.observer=new IntersectionObserver(this.handleIntersection.bind(this),options);document.querySelectorAll("pubguru[data-pg-ad]").forEach(el=>{this.observer.observe(el)})},handleIntersection:function(entries){entries.forEach(entry=>{if(entry.isIntersecting){const adSlot=entry.target.getAttribute("data-pg-ad");this.loadAd(adSlot);this.observer.unobserve(entry.target)}})},loadAd:function(slotName){const adUnit=pg.adUnits.find(unit=>unit.slot===slotName);if(!adUnit)return;const container=document.querySelector(`pubguru[data-pg-ad="${slotName}"]`);if(!container)return;const slotId=pg.gam.createSlot(adUnit);container.innerHTML=`<div id="${slotId}"></div>`;googletag.cmd.push(()=>{googletag.display(slotId)});pg.utils.log(`Loaded ad: ${slotName}`,"lazy")},loadAllAds:function(){pg.adUnits.forEach(unit=>{this.loadAd(unit.slot)})}};pg.vignette={shown:false,cooldown:5*60*1e3,canShow:function(){if(this.shown)return false;const lastShown=pg.utils.cookie("pg_vignette_last");if(lastShown&&Date.now()-parseInt(lastShown)<this.cooldown){return false}return true},show:function(){if(!this.canShow()||!pg.config.vignette)return false;const overlay=document.createElement("div");overlay.style.cssText=`
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;const adContainer=document.createElement("div");adContainer.style.cssText=`
                background: white;
                padding: 20px;
                border-radius: 8px;
                max-width: 90%;
                max-height: 90%;
                position: relative;
            `;const closeBtn=document.createElement("button");closeBtn.innerHTML="&times;";closeBtn.style.cssText=`
                position: absolute;
                top: 10px;
                right: 15px;
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
            `;closeBtn.onclick=()=>{document.body.removeChild(overlay);this.shown=true;pg.utils.cookie("pg_vignette_last",Date.now().toString(),1)};adContainer.appendChild(closeBtn);adContainer.innerHTML+='<div id="vignette-ad">Vignette Ad Space</div>';overlay.appendChild(adContainer);document.body.appendChild(overlay);pg.utils.log("Vignette ad shown","vignette");return true}};pg.rebid={rounds:0,maxRounds:pg.config.rebidRounds,init:function(){if(!pg.config.rebid)return;googletag.cmd.push(()=>{googletag.pubads().addEventListener("slotRenderEnded",this.handleSlotRender.bind(this))})},handleSlotRender:function(event){if(event.isEmpty&&this.rounds<this.maxRounds){this.rounds++;pg.utils.log(`Rebid attempt ${this.rounds}`,"rebid");setTimeout(()=>{googletag.pubads().refresh([event.slot])},1e3)}}};pg.init=function(){pg.utils.log("Initializing optimized PG system","init");pg.botProtection.init();pg.gam.init();pg.rewarded.init();pg.rebid.init();pg.drq=pg.drq||[];const executeDomReadyQueue=()=>{pg.utils.log("Executing DOM ready queue, items: "+pg.drq.length,"init");while(pg.drq.length>0){const fn=pg.drq.shift();if(typeof fn==="function"){try{fn()}catch(error){pg.utils.log("Error executing DOM ready function: "+error.message,"init")}}}if(pg.config.lazy){pg.lazy.init()}else{pg.lazy.loadAllAds()}setTimeout(()=>{if(Math.random()<pg.config.vignetteChance){const shown=pg.vignette.show();if(shown&&window.TopbestofAdConfig&&window.TopbestofAdConfig.callbacks.onVignetteShown){window.TopbestofAdConfig.callbacks.onVignetteShown()}}},pg.config.vignetteDelay)};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",executeDomReadyQueue)}else{setTimeout(executeDomReadyQueue,0)}};window.RewardAd=function(){return pg.rewarded.show()};pg.init();pg.utils.log("Optimized PG system loaded","init")})();