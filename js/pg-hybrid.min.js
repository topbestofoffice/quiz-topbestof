(function(){"use strict";const startTime=performance.now();if(/bot|googlebot|crawler|spider|robot|crawling|facebookexternalhit|lighthouse|headless/i.test(navigator.userAgent)){console.warn("[Topbestof] Bot detected - optimizing ad loading");window.pgBotDetected=true}window.TopbestofPerf={scriptLoad:startTime,pgLoad:null,firstAd:null,rewardReady:null};window.pgOptimizations={disableHeaderBidding:true,disableAnalytics:true,disableA11y:true,enableFastMode:true,skipNonEssential:true};const originalPg=window.pg;window.pg=window.pg||{};const originalDrq=[];Object.defineProperty(window.pg,"drq",{get:function(){return originalDrq},set:function(value){if(Array.isArray(value)){originalDrq.splice(0,originalDrq.length,...value)}}});window.pg.drq=window.pg.drq||[];const originalPush=window.pg.drq.push;window.pg.drq.push=function(fn){if(typeof fn==="function"){const wrappedFn=function(){const fnStart=performance.now();try{const result=fn.apply(this,arguments);console.log(`[Topbestof] PG callback executed in ${(performance.now()-fnStart).toFixed(2)}ms`);return result}catch(error){console.error("[Topbestof] PG callback error:",error);throw error}};return originalPush.call(this,wrappedFn)}return originalPush.apply(this,arguments)};window.TopbestofRewards={ready:false,renderEvent:null,coins:100,show:function(){console.log("[Topbestof] Triggering optimized reward ad");if(this.renderEvent&&typeof this.renderEvent.makeRewardedVisible==="function"){try{this.renderEvent.makeRewardedVisible();return true}catch(error){console.error("[Topbestof] RenderEvent error:",error)}}const rewardedElements=document.querySelectorAll(".pg-rewarded");if(rewardedElements.length>0){try{rewardedElements[0].click();return true}catch(error){console.error("[Topbestof] Click error:",error)}}const tempElement=document.createElement("a");tempElement.className="pg-rewarded";tempElement.href="intent://details?id=com.topbestof.qwizb#Intent;scheme=market;package=com.android.vending;end";tempElement.style.display="none";document.body.appendChild(tempElement);try{tempElement.click();setTimeout(()=>document.body.removeChild(tempElement),1e3);return true}catch(error){console.error("[Topbestof] Temp element error:",error);return false}},onRewardGranted:function(coins=this.coins){const currentCoins=parseInt(localStorage.getItem("totalcoin")||"0");const newTotal=currentCoins+coins;localStorage.setItem("totalcoin",newTotal.toString());if(window.showToast){window.showToast({title:"Congratulations!",msg:`ðŸ¥³ Reward Added - ${coins} Coins!`})}setTimeout(()=>{location.href="/playquiz.html"},2e3)},onRewardFailed:function(reason="Ad not available"){if(window.showToast){window.showToast({title:"Sorry!",msg:`ðŸš« ${reason}`})}}};const adObserver=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){const adElement=entry.target;const adSlot=adElement.getAttribute("data-pg-ad");if(adSlot){console.log(`[Topbestof] Ad slot ${adSlot} is visible, prioritizing load`);if(window.googletag&&googletag.pubads){googletag.cmd.push(()=>{const slots=googletag.pubads().getSlots();const targetSlot=slots.find(slot=>slot.getAdUnitPath().includes(adSlot));if(targetSlot){googletag.pubads().refresh([targetSlot])}})}}adObserver.unobserve(adElement)}})},{rootMargin:"200px"});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pubguru[data-pg-ad]").forEach(el=>{adObserver.observe(el)})});const originalLoadJs=window.pg.loadJs||window.pg.loadJS;if(originalLoadJs){window.pg.loadJs=window.pg.loadJS=function(src,async,onload,onerror){const loadStart=performance.now();const wrappedOnload=function(){window.TopbestofPerf.pgLoad=performance.now()-loadStart;console.log(`[Topbestof] PubGuru loaded in ${window.TopbestofPerf.pgLoad.toFixed(2)}ms`);if(onload)onload.apply(this,arguments)};const wrappedOnerror=function(error){console.error("[Topbestof] PubGuru load error:",error);if(window.googletag){console.log("[Topbestof] Falling back to basic GAM");googletag.cmd.push(()=>{googletag.pubads().enableSingleRequest();googletag.enableServices()})}if(onerror)onerror.apply(this,arguments)};return originalLoadJs.call(this,src,async,wrappedOnload,wrappedOnerror)}}window.checkTopbestofPerformance=function(){const perf=window.TopbestofPerf;const total=performance.now()-perf.scriptLoad;console.group("[Topbestof] Performance Report");console.log(`Total time: ${total.toFixed(2)}ms`);console.log(`PubGuru load: ${perf.pgLoad?perf.pgLoad.toFixed(2)+"ms":"Not loaded"}`);console.log(`First ad: ${perf.firstAd?perf.firstAd.toFixed(2)+"ms":"Not loaded"}`);console.log(`Reward ready: ${perf.rewardReady?perf.rewardReady.toFixed(2)+"ms":"Not ready"}`);console.groupEnd();if(window.showToast){window.showToast({title:"Performance",msg:`ðŸ“Š Total: ${total.toFixed(0)}ms, PG: ${perf.pgLoad?perf.pgLoad.toFixed(0)+"ms":"Loading"}`})}};window.RewardAd=function(){return window.TopbestofRewards.show()};console.log(`[Topbestof] Hybrid optimization loaded in ${(performance.now()-startTime).toFixed(2)}ms`)})();